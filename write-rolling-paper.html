<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolling</title>
    <!-- <link rel="stylesheet" href="/css/WriteRolling.css"> -->
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link rel="stylesheet" href="./css/write-rolling-paper.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="wrap">
        <header>
            <span class="rolling_title" onclick="goHome()">Rolling</span>
            <!-- <div class="hamberger_menu"><iconify-icon icon="material-symbols:menu" width="25"
                    height="24"></iconify-icon></div> -->
        </header>
        <button class="delete_btn">롤링페이퍼 지우기</button>
        <main>
            <div class="top_box">
                <div class="rec_box">
                    <div class="rec_tit">To.</div>
                    <input type="text" id="recipient_input">
                </div>
                <button id="sharebtn"><iconify-icon icon="ph:share-fat-fill" width="25"
                        height="23"></iconify-icon></button>
            </div>
            <div class="middle_box"></div>
            <div class="bottom_box">
                <div class="btn edit"><iconify-icon icon="mdi:pencil-add" width="30" height="28"
                        onclick="createPaper()"></iconify-icon></div>
                <div class="btn emoji"><iconify-icon icon="mdi:emoji" width="30" height="29"></iconify-icon></div>
            </div>

        </main>
        <button class="send_btn">전송하기</button>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        let receiver = "";

        const url = new URL(window.location.href);
        console.log(url);

        // URLSearchParams 객체
        const urlParams = url.searchParams;

        // URLSearchParams.get()
        let id = urlParams.get('paper_id');

        // 2. ajax 함수 이용해서 api 호출, success 응답 호출 해보기
        $.support.cors = true;
        $.ajax({
            type: 'get',           // 타입 (get, post, put 등등)
            url: `http://localhost:3000/api/rollingpapers/${id}`,           // 요청할 서버url
            async: true,            // 비동기화 여부 (default : true)
            dataType: 'json',       // 데이터 타입 (html, xml, json, text 등등)
            data: {},
            contentType: "application/json",
            success: function (result) { // 결과 성공 콜백함수
                console.log(result);
                setRollingPaperHtml(result.result.receiver);// 받는 사람 띄우기
            }
        });

        function setRollingPaperHtml(receiver) {
            $(".rec_box").append(getRollingPaperHtml(receiver));// html - 덮어씌우기, append - 추가하기
        }

        function getRollingPaperHtml(receiver) {
            return `<div class="rec_tit">To.</div>
                    <div id="recipient_input">${receiver}</div>`;
        }

        function createPaper() {
            console.log(id);
            window.location.href = `../write-rolling-paper-creating.html?paper_id=${id}`;
        }

    </script>
    <script>
        // 2. ajax 함수 이용해서 api 호출, success 응답 호출 해보기
        $.support.cors = true;
        $.ajax({
            type: 'get',           // 타입 (get, post, put 등등)
            url: `http://localhost:3000/api/papers`,           // 요청할 서버url
            async: true,            // 비동기화 여부 (default : true)
            dataType: 'json',       // 데이터 타입 (html, xml, json, text 등등)
            data: {},
            contentType: "application/json",
            success: function (result) { // 결과 성공 콜백함수
                result.result.forEach((result) => {
                    if ( result.paper_id === Number(id) ) {
                        console.log(result);
                        showListPapers(result.content, result.writer, result.font);// 받는 사람 띄우기
                    }
                });
            }
        });

        function showListPapers(content, writer, font) {
            var memo = document.createElement('div');
            var fromSender = document.createElement('div');

            memo.innerText = content;
            memo.style.fontFamily = font;
            fromSender.innerText = `From. ${writer}`;
            memo.className = 'memo';
            fromSender.className = 'from_sender';

            console.log(memo);
            paper.appendChild(memo);
            memo.appendChild(fromSender);
        }
    </script>
    <script src="./js/script.js"></script>
    <script src="./js/write-rolling-paper.js"></script>
</body>

</html>