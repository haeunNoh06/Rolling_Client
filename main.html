<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <header>
        <div class="title" onclick="goHome()">Rolling</div>
        <img id="menu-outline" src="img/menu-outline.svg" alt="메뉴바">
    </header>
    <main>
        <div class="add-page">
            <button class="add-btn">
                <a href="./rolling-paper-creating.html">
                    <img src="./img/plus.png" alt="페이지 더 만들기">
                </a>
            </button>
        </div>
        <div class="list">
            <div class="search">
                <input type="text" class="search">

                <img src="img/search-outline.svg" alt="검색버튼">

            </div>
            <div class="pages"></div>
        </div>
    </main>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // 1. JQUERY CDN 삽입


        // 2. ajax 함수 이용해서 api 호출, success 응답 호출 해보기
        $.support.cors = true;
        $.ajax({
            type: 'get',           // 타입 (get, post, put 등등)
            url: 'http://localhost:3000/api/rollingpapers',           // 요청할 서버url
            async: true,            // 비동기화 여부 (default : true)
            dataType: 'json',       // 데이터 타입 (html, xml, json, text 등등)
            data: {},
            success: function (result) { // 결과 성공 콜백함수
                result.result.forEach((result) => {
                    console.log(result);
                    setPaperHtml(result.id, result.title, result.maker, result.created_at.substr(0,10));
                });
            }
        });
        
        function setPaperHtml(id, title, maker, date) {
            $(".pages").append(getPaperHtml(id, title, maker, date));// html - 덮어씌우기, append - 추가하기
        }

        function getPaperHtml(id, title, maker, date) {
            return `<div class="paper" onclick="showPaper(${id})">
                        <div class="title">${title}</div>
                        <div class="detail">
                            <div class="from">From. ${maker}</div>
                            <div class="date">${date}</div>
                        </div>
                    </div>`;
        }

        function showPaper(id) {
            console.log("creating입니다");
            location.href = `./write-rolling-paper.html?id=${id}`;
        }
    </script>
    <script src="./js/script.js"></script>
  
</body>

</html>